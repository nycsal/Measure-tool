<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KaKaCalculate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(120deg, #ffb300 0%, #8bc34a 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', sans-serif;
    }
    .kaka-header {
      font-size: 2rem;
      font-weight: bold;
      color: #fff;
      text-align: center;
      padding: 2vh 0 1vh 0;
      letter-spacing: 2px;
      text-shadow: 1px 1px 6px #444;
    }
    .lang-btn-group .btn {
      font-weight:600;
      background-color:#fff3cd;
    }
    .food-btn {
      width:100%;margin:10px 0;font-size:1.2rem;padding:1.2rem;background: #ffffffcc;color: #222;border-radius:1rem;border:none;font-weight: 600;box-shadow:0 2px 8px #5552;
      transition: background .2s;
    }
    .food-btn:hover { background: #ffe082;}
    .fixed-bottom-bar {
      background: #054709cc;
      color:#fff;padding:1vh 0;text-align:center;font-weight:bold;box-shadow:0 -3px 12px #0003;
    }
    .modal-content{border-radius:1rem;}
    .number-input{
      width:80px;border-radius:8px;text-align:center;font-size:1.2rem;margin:10px 10px;
    }
    .input-group-text {background: #e3ffdc;}
    .msg-btn:active, .msg-btn:focus {outline:none;}
  </style>
</head>
<body>
  <div class="kaka-header">KaKaCalculate</div>
  <div class="d-flex justify-content-center lang-btn-group mb-2">
    <button class="btn btn-light mx-1" onclick="setLang('en')" id="lang-en">English</button>
    <button class="btn btn-light mx-1" onclick="setLang('fa')" id="lang-fa">فارسی</button>
    <button class="btn btn-light mx-1" onclick="setLang('de')" id="lang-de">Deutsch</button>
  </div>
  <div class="container" id="app-main" style="max-width: 460px;min-height:55vh;"></div>
  
  <div class="fixed-bottom-bar">
    <span id="footer-text">For home cooks: Fast, fun, accurate.</span>
  </div>

  <!-- Result Modal -->
  <div class="modal fade" tabindex="-1" id="resultModal">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title" id="resultTitle"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="resultBody"></div>
        <div class="modal-footer">
          <input type="tel" class="form-control" id="smsPhone" maxlength="18" placeholder="Phone number for SMS" />
          <button class="btn btn-success msg-btn" onclick="sendSMS()"><span id="smsBtnLabel"></span></button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Core Logic
    const foodData = {
      rice:{en:"Rice",fa:"برنج",de:"Reis",unit:"g",perPerson:90, note:{en:"uncooked",fa:"خام",de:"roh"}},
      mashedPotatoes:{en:"Mashed Potatoes",fa:"پوره سیب‌زمینی",de:"Kartoffelpüree",unit:"potatoes",perPerson:2,note:{en:"medium size",fa:"سایز متوسط",de:"mittelgroß"}},
      groundMeat:{en:"Ground Meat (kebab)",fa:"کباب چرخ‌کرده",de:"Hackfleisch (Kebab)",unit:"g",perPerson:120,note:{en:"raw",fa:"خام",de:"roh"}},
      tikaKebab:{en:"Tika Kebab",fa:"کباب تیکه",de:"Tika Kebab",unit:"skewers",perPerson:1,note:{en:"4 pieces per skewer",fa:"۴ تکه در سیخ",de:"4 Stück pro Spieß"}},
      lambQurma:{en:"Lamb Qurma",fa:"قورمه گوسفندی",de:"Lamm Qurma",unit:"g",perPerson:150,note:{en:"raw lamb",fa:"گوشت خام",de:"rohes Lamm"}},
      okra:{en:"Okra Stew",fa:"بامیه",de:"Okraschoten-Eintopf",unit:"g",perPerson:80,note:{en:"fresh",fa:"تازه",de:"frisch"}},
      mantoo:{en:"Mantoo (dumplings)",fa:"منتو",de:"Mantoo (Teigtaschen)",unit:"pieces",perPerson:5,note:{en:"per person",fa:"برای هر نفر",de:"pro Person"}},
      cheese:{en:"Cheese",fa:"پنیر",de:"Käse",unit:"g",perPerson:40,note:{en:"for salad/sides",fa:"برای سالاد/علاوه",de:"für Salat/Beilage"}},
    };

    const appTexts = {
      en: {
        askGuests: "How many guests do you have?",
        or: "or",
        nextFoods: "Select a food type:",
        enterGuests: "Enter number",
        make: "You will need",
        of: "of",
        for: "for",
        guests: "guests",
        shareSMS: "Text result",
        foodListTitle: "Choose your dish",
        langSet: "Language changed",
        close: "Close",
        msgPlaceholder: "Phone number for SMS",
        defaultFooter: "For home cooks: Fast, fun, accurate.",
        numberError: "Enter a positive number!"
      },
      fa: {
        askGuests: "تعداد مهمان‌ها چند نفر است؟",
        or: "یا",
        nextFoods: "نوع غذا را انتخاب کنید:",
        enterGuests: "تعداد را وارد کنید",
        make: "شما نیاز دارید به",
        of: "از",
        for: "برای",
        guests: "نفر",
        shareSMS: "ارسال پیامک",
        foodListTitle: "یک غذا انتخاب کنید",
        langSet: "زبان تغییر کرد",
        close: "بستن",
        msgPlaceholder: "شماره برای پیامک",
        defaultFooter: "برای آشپزها: سریع، جذاب، دقیق.",
        numberError: "عدد مثبت وارد کنید!"
      },
      de: {
        askGuests: "Wie viele Gäste haben Sie?",
        or: "oder",
        nextFoods: "Wählen Sie eine Speise:",
        enterGuests: "Anzahl eingeben",
        make: "Sie benötigen",
        of: "von",
        for: "für",
        guests: "Gäste",
        shareSMS: "Per SMS senden",
        foodListTitle: "Gericht auswählen",
        langSet: "Sprache geändert",
        close: "Schließen",
        msgPlaceholder: "Telefonnummer für SMS",
        defaultFooter: "Für Hobbyköche: Schnell, unterhaltsam, genau.",
        numberError: "Bitte eine positive Zahl eingeben!"
      }
    };

    let curLang = 'en', guestCount = 0, selectedFood = null, lastResultMsg = '';

    function $(id){ return document.getElementById(id); }

    function setLang(lang) {
      curLang = lang;
      document.querySelectorAll(".lang-btn-group .btn").forEach(btn => btn.classList.remove('text-success','font-weight-bold'));
      document.getElementById('lang-'+lang).classList.add('text-success','font-weight-bold');
      $('footer-text').innerText = appTexts[lang].defaultFooter;
      renderApp();
    }

    function renderApp() {
      let html = `
        <div class="card shadow p-3" style="border-radius:1.5rem;">
          <div class="text-center font-weight-bold mb-2" style="font-size:1.3rem;">${appTexts[curLang].askGuests}</div>
          <div class="input-group justify-content-center mb-3">
            <input type="number" min="1" id="guestsInput" class="form-control number-input" placeholder="${appTexts[curLang].enterGuests}">
            <div class="input-group-append">
              <button class="btn btn-success" type="button" onclick="saveGuests()">&nbsp;OK&nbsp;</button>
            </div>
          </div>
          <div class="small text-center mb-2">${appTexts[curLang].or}</div>
          <div class="d-flex justify-content-center">
            <button class="btn btn-outline-info mx-1" onclick="setGuests(2)">2</button>
            <button class="btn btn-outline-info mx-1" onclick="setGuests(4)">4</button>
            <button class="btn btn-outline-info mx-1" onclick="setGuests(10)">10</button>
            <button class="btn btn-outline-info mx-1" onclick="setGuests(20)">20</button>
          </div>
        </div>
      `;
      // If guests already set, show food buttons
      if (guestCount>0) html += renderFoodList();
      $('app-main').innerHTML = html;
      $('#smsBtnLabel').innerText = appTexts[curLang].shareSMS;
    }

    function saveGuests() {
      let val = parseInt(document.getElementById('guestsInput').value,10);
      if (!val || val<1) { alert(appTexts[curLang].numberError); return;}
      guestCount = val;
      renderApp();
    }

    function setGuests(n) {
      guestCount=n;
      renderApp();
    }

    function renderFoodList() {
      let foodsHtml = `<div class="mt-3 card" style="border-radius:1.5rem;background-color:#f0fff0cf;">
        <div class="card-header text-center font-weight-bold" style="font-size:1.2rem;">${appTexts[curLang].nextFoods}</div>
        <div class="card-body pb-1">`;
      for (let f in foodData) {
        foodsHtml += `
        <button class="food-btn" onclick="selectFood('${f}')">
          ${foodData[f][curLang]}
        </button>
        `;
      }
      foodsHtml+=`</div></div>`;
      return foodsHtml;
    }

    function selectFood(foodKey) {
      selectedFood = foodKey;
      showResult();
    }

    function showResult() {
      let food = foodData[selectedFood];
      let tot = Math.ceil(guestCount * food.perPerson);
      let unit = food.unit;
      let note = food.note[curLang];
      let displayTot = tot;
      // If grams >900, use kg
      if (unit==='g' && tot>=1000) { displayTot = Math.round((tot/100))/10; unit='kg'; }
      let msg = `${appTexts[curLang].make} <b>${displayTot}</b> ${unit} (${note}) ${appTexts[curLang].of} <b>${food[curLang]}</b> ${appTexts[curLang].for} <b>${guestCount}</b> ${appTexts[curLang].guests}.`;
      lastResultMsg = msg.replace(/<b>|<\/b>/g,'');
      $('#resultTitle').innerHTML = food[curLang];
      $('#resultBody').innerHTML = msg;
      $('#smsBtnLabel').innerText = appTexts[curLang].shareSMS;
      $('#smsPhone').placeholder = appTexts[curLang].msgPlaceholder;
      $('#resultModal').modal('show');
    }

    function sendSMS() {
      let phone = $('#smsPhone').value.replace(/[^\d+]/g, '');
      let text = encodeURIComponent(lastResultMsg);
      let uri = `sms:${phone}?body=${text}`;
      window.location.href = uri;
    }

    // JS+HTML integration for modal, events:
    window.setLang = setLang;
    window.saveGuests = saveGuests;
    window.setGuests = setGuests;
    window.selectFood = selectFood;
    window.sendSMS = sendSMS;

    // Init
    setLang('en');
  </script>
</body>
</html>
